<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>1A2B</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="application-name" content="猜1A2B">
    <meta name="description" content="由電腦猜1A2B的小遊戲">
    <meta name="application-url" content="https://pixmi.app/1a2b/">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body class="p-3">
    <div class="container">
        <div class="row mb-3">
            <div class="col-12">
                <h4>遊戲規則:</h4>
                <p>請在0到9的數字中，分別選擇3個不同數字。</p>
            </div>
            <div class="col-auto">
                <button type="button" id="iStartGame" class="btn btn-primary" onclick="cancelGame();">遊戲開始</button>
            </div>
            <div class="col-auto">
                <button type="button" id="iCancelGame" class="btn btn-danger" onclick="cancelGame();" style="display:none">重開一場遊戲</button>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <h3 id="out"></h3>
            </div>
        </div>
        <div class="row g-3" id="answerblock" style="display:none">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="card-title">位置和數字全部符合的數量數字</div>
                        <form name="AAA" id="AAA">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="A_answer" id="A_r1" value="0" checked>
                                <label class="form-check-label" for="A_r1">0A</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="A_answer" id="A_r2" value="1">
                                <label class="form-check-label" for="A_r2">1A</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="A_answer" id="A_r3" value="2">
                                <label class="form-check-label" for="A_r3">2A</label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="card-title">位置不同但答案裡有的數字數量</div>
                        <form name="BBB" id="BBB">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="A_answer" id="B_r1" value="0" checked>
                                <label class="form-check-label" for="B_r1">0B</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="A_answer" id="B_r2" value="1">
                                <label class="form-check-label" for="B_r2">1B</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="A_answer" id="B_r3" value="2">
                                <label class="form-check-label" for="B_r3">2B</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="A_answer" id="B_r4" value="2">
                                <label class="form-check-label" for="B_r4">3B</label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-12">
                <button type="button" class="btn btn-dark" onclick="answer()">確認</button>
            </div>
        </div>
    </div>
    <script>
        let answerBase = new Array(721);
        let isOver, restart;  //當作布林值，判斷是否遊戲結束以及是否要繼續玩
        let remain;  //答案庫裡面的答案數 
        let a, b;  //拿來裝使用者回答的幾a幾b
        let randNum;  //裝亂數，隨機從答案庫裡面拿答案 

        function prepare() {
            out.innerHTML = "";

            let i, tmp, unit_1, unit_10, unit_100;
            remain = 720;
            tmp = 0;
            isOver = 0;

            for (i = 0; i < 721; i++)
                answerBase[i] = new Array(3);

            for (i = 0; i < 1000; i++) {  //這個for產生答案庫 
                unit_1 = Math.floor(i / 1) % 10;  //以下四行把四位數拆成四個各位數分別存到四個變數 
                unit_10 = Math.floor(i / 10) % 10;
                unit_100 = Math.floor(i / 100) % 10;
                if (unit_1 != unit_10 && unit_1 != unit_100 && unit_10 != unit_100) {
                    answerBase[tmp][0] = unit_100;
                    answerBase[tmp][1] = unit_10;
                    answerBase[tmp][2] = unit_1;
                    tmp++;
                }
            }

            iCancelGame.style.display = "block";
        }
        function ask() {
            let i;
            let j;
            let printNum = "";

            let printRemainNum = "";

            if (remain == 1) {
                for (j = 0; j < 3; j++)
                    printRemainNum += answerBase[0][j];

                out.innerHTML += "謎題全部解開了。<br>我賭上我爺爺的名譽就是";
                out.innerHTML += "<font color=red>" + printRemainNum + "</font><br>"
                answerblock.style.display = "none";
                isOver = 1;
                return;
            }

            if (remain <= 3) {
                out.innerHTML += "可能解:";
                for (i = 0; i < remain; i++) {
                    for (j = 0; j < 3; j++)
                        printRemainNum += answerBase[i][j];
                    if (i < remain - 1)
                        printRemainNum += ", "
                }
                out.innerHTML += "<font color=black>" + printRemainNum + "</font><br><br>";

            }
            while (1 == 1) {
                randNum = 0;
                for (i = 0; i < 3; i++) {
                    randNum *= 10;
                    randNum += Math.floor(Math.random() * 10);
                }
                if (randNum < remain) break;
            }
            for (i = 0; i < 3; i++)
                printNum += answerBase[randNum][i];

            out.innerHTML += " 我猜: <font color=red>" + printNum + "</font><br>";
            answerblock.style.display = "block";
        }

        function answer() {
            let input = new Array(500);
            let right = 0;  //當布林值，判斷是否正確的輸入
            let tempA;
            let tempB;
            do {  //取得a,b值 
                do {  //取得a值
                    let form = document.getElementById("AAA");
                    for (let i = 0; i < form.A_answer.length; i++) {
                        if (form.A_answer[i].checked) {
                            tempA = form.A_answer[i].value;
                        }
                    }
                    if (tempA.length == 1 && parseInt(tempA) <= 9 && parseInt(tempA) >= 0) {
                        a = parseInt(tempA);
                        right = 1;
                    }
                    else alert("輸入錯誤");
                    break;
                } while (!right);
                do {  //取得b值
                    let form = document.getElementById("BBB");
                    for (let i = 0; i < form.B_answer.length; i++) {
                        if (form.B_answer[i].checked) {
                            tempB = form.B_answer[i].value;
                        }
                    }
                    if (tempB.length == 1 && parseInt(tempB) <= 9 && parseInt(tempB) >= 0) {
                        b = parseInt(tempB);
                        right = 1;
                    }
                    else alert("輸入錯誤");
                    break;
                } while (!right);

                if (a + b > 3) {  //如果a和b相加大於3當然就錯啦～ 
                    alert("輸入錯誤");
                    right = 0;
                    break;
                }
            } while (!right);

            tempA = tempB = 0;
            out.innerHTML += "..." + a + "A" + b + "B<br><font size=-2><br></font>"

            if (a == 3) {
                out.innerHTML += "輸入3A你時間真的也蠻多的XD<br>";
                answerblock.style.display = "none";
                isOver = 1;
            }
            else if (remain == 1) {  //如果答案庫只剩一個答案，但是這答案還是錯的，就是玩家作弊！
                out.innerHTML += "這一定哪裡有什麼誤會<br>";
                answerblock.style.display = "none";
                isOver = 1;
            }

            if (!isOver)
                think();
            if (!isOver)
                ask();
            document.getElementById("A_r1").checked = true;
            document.getElementById("B_r1").checked = true;
        }
        function think() {
            let i, j, k, aa, bb;
            let refer = new Array(3);
            for (i = 0; i < 3; i++) {
                refer[i] = answerBase[randNum][i];
            }
            for (i = 0; i < remain; i++) {
                aa = bb = 0;  //填裝a值和b值，但要區別於之前的人類輸入的a值b值 
                for (j = 0; j < 3; j++) {  //以下兩個for用來比對第i個答案和亂數取的答案的是幾a幾b 
                    for (k = 0; k < 3; k++) {
                        if (answerBase[i][j] == refer[k]) {
                            if (j == k) aa++;
                            else bb++;
                        }
                    }
                }
                if (!((aa == a) && (bb == b))) {  //把a值b值相等的答案保留下來 
                    for (j = i; j < remain; j++) {  //開始搬運 
                        for (k = 0; k < 3; k++) {
                            //console.log(j);
                            //console.log(k);
                            //console.log('////////////');
                            answerBase[j][k] = answerBase[j + 1][k];
                        }
                    }
                    remain--;
                    i--;
                }
            }
            if (remain == 0) {  //發現沒有答案符合玩家想的數字，就是玩家作弊！
                out.innerHTML += "你應該是輸入錯誤...重來吧<br>";
                isOver = 1;
            }
        }

        function cancelGame() {
            iCancelGame.style.display = "none";
            prepare();
            ask();
            document.getElementById("A_r1").checked = true;
            document.getElementById("B_r1").checked = true;
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>

</html>
